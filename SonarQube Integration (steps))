# ðŸ”§ Integrating SonarQube with Jenkins

This guide explains how to connect Jenkins with a SonarQube server so that Jenkins can run code
analysis using the SonarQube Scanner and upload results to the SonarQube dashboard.

---
 Make sure you have set sonarqube in global tools configuration
-(manage jenkins->settings->tools->sonarqube)
-Add name and select the version

## 1. Prerequisites
- Jenkins server running in your VPC
- SonarQube server running in the same VPC (with Nginx reverse proxy on port 80 â†’ SonarQube port 9000)
- Both Jenkins and SonarQube must be able to communicate via **private IPs**

---

## 2. Configure SonarQube Server in Jenkins
1. Go to **Manage Jenkins â†’ System**.
2. Scroll down to **SonarQube servers**.
3. Check **Environment variables**.
4. Click **Add SonarQube**:
   - **Name**: `Sonar Server`
   - **Server URL**:  
     ```
     http://<private-ip-of-sonarqube>:80
     ```
   - Save changes.

---

## 3. Generate SonarQube Authentication Token
1. Log in to **SonarQube UI**.
2. Click your profile icon â†’ **My Account â†’ Security**.
3. Under **Tokens**, enter a name (e.g., `Jenkins`).
4. Select **User Token** â†’ Click **Generate**.
5. Copy the token (âš ï¸ oneâ€‘time only â€” regenerate if lost).

---

## 4. Store Token in Jenkins Credentials
1. In Jenkins â†’ **Manage Jenkins â†’ Credentials**.
2. Add new credential:
   - **Kind**: Secret text
   - **Secret**: Paste the SonarQube token
   - **ID**: `sonar-token`
   - **Description**: `SonarQube Token`
3. Save.

---

## 5. Security Group Configuration
- Ensure **SonarQube serverâ€™s security group** allows **inbound port 80** from Jenkinsâ€™ security group.
- This ensures Jenkins can reach SonarQube internally without exposing it to the internet.

---

## 6. Install SonarQube Scanner in Jenkins
1. Go to **Manage Jenkins â†’ Global Tool Configuration**.
2. Scroll to **SonarQube Scanner**.
3. Click **Add SonarQube Scanner**:
   - **Name**: `SonarScanner`
   - Optionally check **Install automatically**.
4. Save.

---

## 7. Use SonarQube in Jenkins Pipeline
Add a stage in your Jenkinsfile:

```groovy
pipeline {
    agent any

    tools {
        maven "Maven3.9"
        jdk "JDK21"
    }

    stages {
        stage("SonarQube Analysis") {
            steps {
                withSonarQubeEnv('Sonar Server') {
                    sh 'mvn sonar:sonar -Dsonar.projectKey=DevopsProject -Dsonar.login=${SONAR_TOKEN}'
                }
            }
        }
    }
}


--> Integrate Quality gates
-SonarQube->quality gate->create->add name->unlock editing-> add condition->overall code->metrics(bugs)->enter value-> save
-enable the quality gate in the specific project in sonarqube
--Projects->project settings->Quality gate->->Always use a specific Quality Gate->choose quality gate(devops)

-->For sonar to comminicate with jenkins after code analysis: enable web hook
-Projects->project settings->web hook->create webhook->add name-> http://172.31.17.80[private ip of jenkins]/sonarqube-webhook

